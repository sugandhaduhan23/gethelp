<div class="container mt-5 py-5 col-12"
    [ngClass]="message.title == messageAction.RESCHEDULED ? 'col-md-8' : 'col-md-8 col-lg-6'"
    *ngIf="message && (message.title != messageAction.NEWMESSAGE && message.title != messageAction.NEWREPLY)">
    <mat-card class="mt-3">
        <mat-card-header>
            <div class="w-100">
                <div class="d-flex justify-content-between">
                    <p><strong>STATUS:</strong> {{message.title}}</p>
                    <p><i class="fas fa-dollar-sign"></i> {{message.workorder.price}}/Hr</p>
                    <p class="text-break"><i class="fas fa-hashtag"></i> {{message.workorder.id}}</p>
                </div>
            </div>
        </mat-card-header>
        <mat-divider></mat-divider>
        <mat-card-content class="pt-3">
            <div class="row">
                <div class="h-100" [ngClass]="message.title == messageAction.RESCHEDULED ? 'col-4' : 'col-6'">
                    <div class="d-flex">
                        <div class="pe-2 align-self-center">
                            <img *ngIf="role == 'customer'" referrerpolicy="no-referrer"
                                [src]="message.workorder.proPhoto" class="rounded-circle user-image" alt="">
                            <img *ngIf="role == 'pro'" referrerpolicy="no-referrer"
                                [src]="message.workorder.customerPhoto" class="rounded-circle user-image" alt="">
                        </div>
                        <div *ngIf="role == 'customer'" class="align-self-center">
                            <div class="h5"><i class="fas fa-tools"></i> {{message.workorder.categoryName}}</div>
                            <div class="h6"><i class="fas fa-hard-hat"></i> {{message.workorder.proName}}</div>
                            <div class="text-break"><b><i
                                        class="fas fa-envelope me-2"></i></b>{{message.workorder.proEmail}}</div>
                        </div>
                        <div *ngIf="role == 'pro'" class="align-self-center">
                            <div class="lead mt-1">{{message.workorder.customerName}}</div>
                            <div class="mt-1 text-break">{{message.workorder.customerEmail}}</div>
                        </div>
                    </div>
                </div>
                <div *ngIf="message.title != messageAction.RESCHEDULED" class="border-start align-self-center col-6">
                    <p> <i class="fas fa-calendar-week text-warning"></i> {{message.workorder.date}},
                        {{message.workorder.time}}</p>
                    <p> <i class="fas fa-map-pin pe-2 text-warning"></i>{{message.workorder.address}}</p>
                    <p> <i class="fas fa-ruler-combined pe-2 text-warning"></i>{{message.workorder.tasktypeName}}
                    </p>
                    <span *ngIf="message.title == messageAction.COMPLETE">
                        <p> <i class="fas fa-clock pe-2 text-warning"></i>{{message.workorder.totalTime}} 1hr</p>
                    </span>
                </div>
                <div class="col-4 border-start border-end align-self-center"
                    *ngIf="message.title == messageAction.RESCHEDULED">
                    <p><strong><u>OLD DETAILS</u></strong></p>
                    <p> <i class="fas fa-calendar-week text-warning"></i> {{message.oldDate}},
                        {{message.oldTime}}</p>
                    <p> <i class="fas fa-map-pin pe-2 text-warning"></i>{{message.oldLocation}}</p>
                </div>
                <div class="col-4 align-self-center" *ngIf="message.title == messageAction.RESCHEDULED">
                    <p><strong><u>NEW DETAILS</u></strong></p>
                    <p> <i class="fas fa-calendar-week text-warning"></i> {{message.workorder.date}},
                        {{message.workorder.time}}</p>
                    <p> <i class="fas fa-map-pin pe-2 text-warning"></i>{{message.workorder.address}}</p>
                </div>
            </div>
        </mat-card-content>
    </mat-card>
</div>


<div class="container mt-5 py-lg-5 col-12 col-md-8 col-lg-6" *ngIf="message && (message.title == messageAction.NEWMESSAGE || message.title == messageAction.NEWREPLY )">
    <div class="row">
        <div class="col-12">
            <mat-card class="mt-3">
                <mat-card-header>
                    <div class="w-100">
                        <div class="d-flex justify-content-between">
                            <p><strong>STATUS:</strong> {{message.title}}</p>
                            <p><i class="fas fa-dollar-sign"></i> {{message.workorder.price}}/Hr</p>
                            <p class="text-break"><i class="fas fa-hashtag"></i> {{message.workorder.id}}</p>
                        </div>
                    </div>
                </mat-card-header>
                <mat-divider></mat-divider>
                <mat-card-content class="pt-3">
                    <div class="row">
                        <div class="h-100 col-6">
                            <div class="d-flex">
                                <div class="pe-2 align-self-center">
                                    <img *ngIf="role == 'customer'" referrerpolicy="no-referrer"
                                        [src]="message.workorder.proPhoto" class="rounded-circle user-image" alt="">
                                    <img *ngIf="role == 'pro'" referrerpolicy="no-referrer"
                                        [src]="message.workorder.customerPhoto" class="rounded-circle user-image"
                                        alt="">
                                </div>
                                <div *ngIf="role == 'customer'" class="align-self-center">
                                    <div class="h5"><i class="fas fa-tools"></i> {{message.workorder.categoryName}}
                                    </div>
                                    <div class="h6"><i class="fas fa-hard-hat"></i> {{message.workorder.proName}}</div>
                                    <div class="text-break"><b><i
                                                class="fas fa-envelope me-2"></i></b>{{message.workorder.proEmail}}
                                    </div>
                                </div>
                                <div *ngIf="role == 'pro'" class="align-self-center">
                                    <div class="lead mt-1">{{message.workorder.customerName}}</div>
                                    <div class="mt-1 text-break">{{message.workorder.customerEmail}}</div>
                                </div>
                            </div>
                        </div>
                        <div class="border-start align-self-center col-6">
                            <p> <i class="fas fa-calendar-week text-warning"></i> {{message.workorder.date}},
                                {{message.workorder.time}}</p>
                            <p> <i class="fas fa-map-pin pe-2 text-warning"></i>{{message.workorder.address}}</p>
                            <p> <i
                                    class="fas fa-ruler-combined pe-2 text-warning"></i>{{message.workorder.tasktypeName}}
                            </p>
                        </div>
                    </div>
                </mat-card-content>
            </mat-card>
        </div>
        <div class="col-12">
            <mat-card class="mt-3">
                <div class="h5">{{message.customTitle}}</div>
                <mat-divider></mat-divider>
                <mat-card-content>
                    <div *ngFor="let reply of message.reply">
                        <mat-divider></mat-divider>
                        <div class="py-3">{{reply.message}}</div>
                        <div class="d-flex">
                            <div>Posted By: {{reply.postedBy}}</div>
                            <div class="ms-auto">Posted On: {{reply.postedOn}}</div>
                        </div>
                    </div>
                    <form [formGroup]="replyForm" *ngIf="showReplyBox" (ngSubmit)="sendReply()" class="m-3">
                        <mat-divider></mat-divider>
                        <mat-form-field appearance="outline" class="w-100">
                            <input matInput type="text" formControlName="message"> 
                        </mat-form-field>
                        <mat-divider></mat-divider>
                         <mat-card-actions class="text-end">
                             <button mat-raised-button color="primary" class="text-light">Post Reply</button>
                             <button mat-raised-button color="primary" class="text-light" (click)="showReplyBox = false">Cancel</button>
                        </mat-card-actions>
                    </form>
                </mat-card-content>
                <span *ngIf="!showReplyBox">
                    <mat-divider></mat-divider>
                <mat-card-actions class="text-end">
                    <button mat-raised-button color="primary" class="text-light" (click)="showReplyBox = true">Reply</button>
                </mat-card-actions>
                </span>
            </mat-card>
        </div>
    </div>
</div>